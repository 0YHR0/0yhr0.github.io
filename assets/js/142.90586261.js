(window.webpackJsonp=window.webpackJsonp||[]).push([[142],{540:function(t,a,r){"use strict";r.r(a);var s=r(2),e=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"k8s-istio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k8s-istio"}},[t._v("#")]),t._v(" K8s Istio")]),t._v(" "),a("h1",{attrs:{id:"istio整体架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#istio整体架构"}},[t._v("#")]),t._v(" Istio整体架构")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241111213529491.png",alt:"image-20241111213529491"}})]),t._v(" "),a("ul",[a("li",[t._v("Galley 是 Istio 的配置验证、提取、处理和分发组件。它确保 Istio 的配置符合规则，并将正确的配置信息传递给其他组件。")])]),t._v(" "),a("hr"),t._v(" "),a("h3",{attrs:{id:"xds-extensible-discovery-service-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xds-extensible-discovery-service-简介"}},[t._v("#")]),t._v(" xDS（eXtensible Discovery Service）简介")]),t._v(" "),a("ul",[a("li",[t._v("xDS 是一组用于发现和配置代理（如 Istio 中的 Envoy）的协议。它提供了一种标准化的方式来动态地向代理传递配置信息，包括服务发现、路由规则、监听器配置等。这些协议允许控制平面（如 Istio 中的 Pilot）与数据平面代理（Envoy）进行通信，以实现对代理行为的灵活控制。")])]),t._v(" "),a("h4",{attrs:{id:"pilot-作为-xds-服务器的角色"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pilot-作为-xds-服务器的角色"}},[t._v("#")]),t._v(" Pilot 作为 xDS 服务器的角色")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("服务发现（LDS - Listener Discovery Service）：")]),t._v(" "),a("ul",[a("li",[t._v("Pilot 作为 xDS 服务器，通过 LDS 向 Envoy 代理提供监听器（Listener）的配置。监听器定义了 Envoy 如何接收和处理传入的网络连接。例如，Pilot 可以告诉 Envoy 在某个特定端口（如 8080 端口）上监听 HTTP 请求，并根据请求的目标服务将其路由到相应的后端服务实例。这种服务发现功能对于动态环境中的微服务架构至关重要，因为服务的位置和端口可能会随着时间变化，Pilot 能够确保 Envoy 始终拥有最新的监听器配置。")])])]),t._v(" "),a("li",[a("p",[t._v("路由发现（RDS - Route Discovery Service）：")]),t._v(" "),a("ul",[a("li",[t._v("RDS 协议用于 Pilot 向 Envoy 传递路由规则。这些路由规则决定了如何将传入的请求路由到不同的后端服务。例如，Pilot 可以配置 Envoy 将带有特定 HTTP 头（如/api/v1路径）的请求路由到一个新的服务版本，而将其他请求路由到旧版本。这使得可以在不修改服务代码的情况下实现灰度发布、金丝雀部署等复杂的流量管理策略。Pilot 作为 xDS 服务器，会根据用户定义的流量管理策略和服务发现信息，通过 RDS 向 Envoy 发送精确的路由配置。")])])]),t._v(" "),a("li",[a("p",[t._v("集群发现（CDS - Cluster Discovery Service）")]),t._v(" "),a("ul",[a("li",[t._v("CDS 协议用于 Pilot 向 Envoy 提供集群（Cluster）配置信息。在 Istio 中，集群代表一组具有相同功能的后端服务实例。Pilot 通过 CDS 告诉 Envoy 哪些服务实例属于同一个集群，以及如何与这些集群进行通信。例如，Pilot 可以为 Envoy 配置一个包含多个微服务实例的集群，包括实例的地址、端口、健康检查策略等信息。这有助于 Envoy 进行负载均衡和故障转移操作，确保请求能够被正确地发送到可用的服务实例。")])])]),t._v(" "),a("li",[a("p",[t._v("端点发现（EDS - Endpoint Discovery Service）")]),t._v(" "),a("ul",[a("li",[t._v("EDS 是 Pilot 用于向 Envoy 提供更详细的端点（Endpoint）信息的协议。端点是指具体的服务实例，在集群中可以有多个端点。Pilot 通过 EDS 让 Envoy 了解每个集群中的具体端点位置和状态。例如，当一个新的服务实例被添加到集群或者一个旧的实例出现故障时，Pilot 会通过 EDS 及时更新 Envoy 的端点信息，使得 Envoy 能够调整其负载均衡策略，避免将请求发送到不可用的端点。")])])])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"管理面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#管理面"}},[t._v("#")]),t._v(" 管理面")]),t._v(" "),a("h3",{attrs:{id:"pilot基本架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pilot基本架构"}},[t._v("#")]),t._v(" Pilot基本架构")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119212645605.png",alt:"image-20241119212645605"}})]),t._v(" "),a("ul",[a("li",[t._v("xDS Generator 是 Pilot 内部的一个重要功能模块。它基于用户定义的各种配置源（如 Istio 的 CRD - Custom Resource Definition，像 VirtualService、DestinationRule 等）和系统的服务发现信息来生成 xDS 协议相关的配置。这些配置是最终通过 xDS Server 发送给 Envoy 代理的内容。")])]),t._v(" "),a("h3",{attrs:{id:"citadel基本架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#citadel基本架构"}},[t._v("#")]),t._v(" Citadel基本架构")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119212729261.png",alt:"image-20241119212729261"}})]),t._v(" "),a("h3",{attrs:{id:"gally基本架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gally基本架构"}},[t._v("#")]),t._v(" Gally基本架构")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119212739579.png",alt:"image-20241119212739579"}})]),t._v(" "),a("h3",{attrs:{id:"pilot-agent基本架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pilot-agent基本架构"}},[t._v("#")]),t._v(" Pilot-Agent基本架构")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119212749578.png",alt:"image-20241119212749578"}})]),t._v(" "),a("ul",[a("li",[a("p",[t._v("代理应用健康检查是通过app prober来做的，把k8s的一些readness等探针，转发给app，依赖probe的自动重写")])]),t._v(" "),a("li",[a("p",[t._v("为什么要经过代理进行健康检查？因为当sidecar开启严格的健康检查，如果没有代理，会直接被envoy拦截")])]),t._v(" "),a("li",[a("p",[t._v("DNSserver：会降低coreDNS的压力，可以为虚拟机上的应用，解析出k8s的服务")])])]),t._v(" "),a("h1",{attrs:{id:"透明的sidecar原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#透明的sidecar原理"}},[t._v("#")]),t._v(" 透明的sidecar原理")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119212801341.png",alt:"image-20241119212801341"}})]),t._v(" "),a("h2",{attrs:{id:"sidecar基本介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sidecar基本介绍"}},[t._v("#")]),t._v(" SideCar基本介绍")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("手动注入：提供一个pod template模板")])]),t._v(" "),a("li",[a("p",[t._v("自动注入：在应用的pod里面再加一个envoy的pod")])])]),t._v(" "),a("h2",{attrs:{id:"sidecar流量拦截"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sidecar流量拦截"}},[t._v("#")]),t._v(" SideCar流量拦截")]),t._v(" "),a("p",[t._v("通过iptable，可以通过init container设置")]),t._v(" "),a("ul",[a("li",[t._v("上面入流量，下面出流量")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119212813648.png",alt:"image-20241119212813648"}})]),t._v(" "),a("h2",{attrs:{id:"envoy流量代理流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#envoy流量代理流程"}},[t._v("#")]),t._v(" Envoy流量代理流程")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119212822569.png",alt:"image-20241119212822569"}})]),t._v(" "),a("h2",{attrs:{id:"envoy流量匹配与转发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#envoy流量匹配与转发"}},[t._v("#")]),t._v(" Envoy流量匹配与转发")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119212831797.png",alt:"image-20241119212831797"}})]),t._v(" "),a("h1",{attrs:{id:"istio基本功能实现原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#istio基本功能实现原理"}},[t._v("#")]),t._v(" Istio基本功能实现原理")]),t._v(" "),a("h2",{attrs:{id:"流量治理基本api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#流量治理基本api"}},[t._v("#")]),t._v(" 流量治理基本API")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119212841653.png",alt:"image-20241119212841653"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119212851338.png",alt:"image-20241119212851338"}})]),t._v(" "),a("img",{staticStyle:{zoom:"33%"},attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/Knative-%E8%B1%86%E5%8C%85%20(3).png",alt:"Knative-豆包 (3)"}}),t._v(" "),a("ul",[a("li",[a("p",[t._v("MCP Server对接其他的注册中心")])]),t._v(" "),a("li",[a("p",[t._v("Aggregater为xDS server提供istio服务的查询功能，有个查询接口")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213219449.png",alt:"image-20241119213219449"}})]),t._v(" "),a("h2",{attrs:{id:"路由匹配"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路由匹配"}},[t._v("#")]),t._v(" 路由匹配")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213226958.png",alt:"image-20241119213226958"}})]),t._v(" "),a("h2",{attrs:{id:"灰度发布"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#灰度发布"}},[t._v("#")]),t._v(" 灰度发布")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213235064.png",alt:"image-20241119213235064"}})]),t._v(" "),a("h2",{attrs:{id:"服务网格监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务网格监控"}},[t._v("#")]),t._v(" 服务网格监控")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213242872.png",alt:"image-20241119213242872"}})]),t._v(" "),a("h3",{attrs:{id:"metrics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#metrics"}},[t._v("#")]),t._v(" Metrics")]),t._v(" "),a("ul",[a("li",[t._v("envoy中也有一些metrics，但都是连接级别的，没有服务的属性")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213252590.png",alt:"image-20241119213252590"}})]),t._v(" "),a("h3",{attrs:{id:"trace调用链"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#trace调用链"}},[t._v("#")]),t._v(" Trace调用链")]),t._v(" "),a("ul",[a("li",[t._v("需要应用做一点点改动，通过trace后端")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213302057.png",alt:"image-20241119213302057"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213322764.png",alt:"image-20241119213322764"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213329069.png",alt:"image-20241119213329069"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213336553.png",alt:"image-20241119213336553"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213345846.png",alt:"image-20241119213345846"}})]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"数据面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据面"}},[t._v("#")]),t._v(" 数据面")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213443889.png",alt:"image-20241119213443889"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213451023.png",alt:"image-20241119213451023"}})]),t._v(" "),a("h3",{attrs:{id:"envoy原理及总体架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#envoy原理及总体架构"}},[t._v("#")]),t._v(" Envoy原理及总体架构")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213500462.png",alt:"image-20241119213500462"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213507339.png",alt:"image-20241119213507339"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213518297.png",alt:"image-20241119213518297"}})]),t._v(" "),a("h4",{attrs:{id:"envoy启动配置及xds"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#envoy启动配置及xds"}},[t._v("#")]),t._v(" Envoy启动配置及xDS")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213631157.png",alt:"image-20241119213631157"}})]),t._v(" "),a("h4",{attrs:{id:"实操"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实操"}},[t._v("#")]),t._v(" 实操")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("static_resources是启动的时候手动配置的")])]),t._v(" "),a("li",[a("p",[t._v("dynamic_resources是从istio控制面拿到的配置")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213541919.png",alt:"image-20241119213541919"}})]),t._v(" "),a("h4",{attrs:{id:"envoy常用部署模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#envoy常用部署模式"}},[t._v("#")]),t._v(" Envoy常用部署模式")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213642286.png",alt:"image-20241119213642286"}})]),t._v(" "),a("h4",{attrs:{id:"envoy网络及线程模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#envoy网络及线程模型"}},[t._v("#")]),t._v(" Envoy网络及线程模型")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213656021.png",alt:"image-20241119213656021"}})]),t._v(" "),a("h4",{attrs:{id:"envoy网络及线程模型-共享数据同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#envoy网络及线程模型-共享数据同步"}},[t._v("#")]),t._v(" Envoy网络及线程模型-共享数据同步")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213703999.png",alt:"image-20241119213703999"}})]),t._v(" "),a("h3",{attrs:{id:"envoy网络及线程模型-集群信息更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#envoy网络及线程模型-集群信息更新"}},[t._v("#")]),t._v(" Envoy网络及线程模型-集群信息更新")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213714455.png",alt:"image-20241119213714455"}})]),t._v(" "),a("h4",{attrs:{id:"envoy网络及线程模型-网络处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#envoy网络及线程模型-网络处理"}},[t._v("#")]),t._v(" Envoy网络及线程模型-网络处理")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213723694.png",alt:"image-20241119213723694"}})]),t._v(" "),a("h4",{attrs:{id:"envoy过滤器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#envoy过滤器"}},[t._v("#")]),t._v(" Envoy过滤器")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213733088.png",alt:"image-20241119213733088"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213743743.png",alt:"image-20241119213743743"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213853851.png",alt:"image-20241119213853851"}})]),t._v(" "),a("h4",{attrs:{id:"envoyhttp请求流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#envoyhttp请求流程"}},[t._v("#")]),t._v(" EnvoyHTTP请求流程")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213901968.png",alt:"image-20241119213901968"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213913634.png",alt:"image-20241119213913634"}})]),t._v(" "),a("h4",{attrs:{id:"envoy问题分析方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#envoy问题分析方法"}},[t._v("#")]),t._v(" Envoy问题分析方法")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213921110.png",alt:"image-20241119213921110"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119213935130.png",alt:"image-20241119213935130"}})]),t._v(" "),a("h2",{attrs:{id:"istio流量治理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#istio流量治理"}},[t._v("#")]),t._v(" Istio流量治理")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214002416.png",alt:"image-20241119214002416"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214010934.png",alt:"image-20241119214010934"}})]),t._v(" "),a("h3",{attrs:{id:"virtualservice"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#virtualservice"}},[t._v("#")]),t._v(" VirtualService")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214019355.png",alt:"image-20241119214019355"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214033378.png",alt:"image-20241119214033378"}})]),t._v(" "),a("ul",[a("li",[a("p",[t._v("hosts是拦截的目标服务，如果match匹配，转发到match的route里")])]),t._v(" "),a("li",[a("p",[t._v("如果没有匹配到，就根据下面的route的权重来分配")])])]),t._v(" "),a("p",[t._v("---\x3e 生成envoy的配置")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214043491.png",alt:"image-20241119214043491"}})]),t._v(" "),a("h4",{attrs:{id:"故障注入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#故障注入"}},[t._v("#")]),t._v(" 故障注入")]),t._v(" "),a("p",[t._v("注入5秒的时延")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214057233.png",alt:"image-20241119214057233"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214113892.png",alt:"image-20241119214113892"}})]),t._v(" "),a("h4",{attrs:{id:"header的更改-包括request和response"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#header的更改-包括request和response"}},[t._v("#")]),t._v(" Header的更改（包括request和response）")]),t._v(" "),a("ul",[a("li",[t._v("比如对header的增删改查")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214123969.png",alt:"image-20241119214123969"}})]),t._v(" "),a("h3",{attrs:{id:"destinationrule"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#destinationrule"}},[t._v("#")]),t._v(" DestinationRule")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214132560.png",alt:"image-20241119214132560"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214149504.png",alt:"image-20241119214149504"}})]),t._v(" "),a("p",[t._v("一般和virtual service配合使用")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("virtual service是基于一些策略把流量路由到目标服务")])]),t._v(" "),a("li",[a("p",[t._v("destination rule允许用户针对目标服务做一些配置，见图")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214158053.png",alt:"image-20241119214158053"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214205302.png",alt:"image-20241119214205302"}})]),t._v(" "),a("p",[t._v("每个subset都对应一些标签，也可以对每个subset应用不同的负载均衡策略")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("可以设置一些连接池配置connectionPool")])]),t._v(" "),a("li",[a("p",[t._v("可以设置outlierDetection，用来故障检测，连续7次5xx错误，就会把某个endpoint驱逐出去，间隔5分钟，基本的注入时间是900秒")])])]),t._v(" "),a("h3",{attrs:{id:"gateway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gateway"}},[t._v("#")]),t._v(" Gateway")]),t._v(" "),a("p",[t._v("在k8s的边缘有独立生成的envoy")]),t._v(" "),a("p",[t._v("外部的服务也可以使用envoy的能力，因为是sidecar")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214216762.png",alt:"image-20241119214216762"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214238545.png",alt:"image-20241119214238545"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214246061.png",alt:"image-20241119214246061"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214256398.png",alt:"image-20241119214256398"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214305216.png",alt:"image-20241119214305216"}})]),t._v(" "),a("h2",{attrs:{id:"服务网格监控-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务网格监控-2"}},[t._v("#")]),t._v(" 服务网格监控")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214312434.png",alt:"image-20241119214312434"}})]),t._v(" "),a("h2",{attrs:{id:"metrics-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#metrics-2"}},[t._v("#")]),t._v(" Metrics")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214318396.png",alt:"image-20241119214318396"}})]),t._v(" "),a("ul",[a("li",[t._v("ALPN（Application - Layer Protocol Negotiation）基本概念\n"),a("ul",[a("li",[t._v("ALPN 是一种在 TLS（Transport Layer Security）握手过程中协商应用层协议的机制。在网络通信中，当客户端和服务器通过 TLS 建立安全连接时，ALPN 允许双方在 TLS 握手阶段就确定后续要使用的应用层协议，而不是在 TLS 连接建立后再去协商。这样可以提高协议选择的效率，减少额外的往返通信。")])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214345595.png",alt:"image-20241119214345595"}})]),t._v(" "),a("h3",{attrs:{id:"trace"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#trace"}},[t._v("#")]),t._v(" Trace")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214355041.png",alt:"image-20241119214355041"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214405647.png",alt:"image-20241119214405647"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214416655.png",alt:"image-20241119214416655"}})]),t._v(" "),a("h3",{attrs:{id:"accesslog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#accesslog"}},[t._v("#")]),t._v(" AccessLog")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214423869.png",alt:"image-20241119214423869"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214430466.png",alt:"image-20241119214430466"}})]),t._v(" "),a("hr"),t._v(" "),a("hr"),t._v(" "),a("h1",{attrs:{id:"传统微服务架构接入istio方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#传统微服务架构接入istio方案"}},[t._v("#")]),t._v(" 传统微服务架构接入istio方案")]),t._v(" "),a("h3",{attrs:{id:"微服务架构业务解耦的同时带来了极大的复杂度"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#微服务架构业务解耦的同时带来了极大的复杂度"}},[t._v("#")]),t._v(" 微服务架构业务解耦的同时带来了极大的复杂度")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214619170.png",alt:"image-20241119214619170"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214635349.png",alt:"image-20241119214635349"}})]),t._v(" "),a("h3",{attrs:{id:"基于网格的服务治理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于网格的服务治理"}},[t._v("#")]),t._v(" 基于网格的服务治理")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214641732.png",alt:"image-20241119214641732"}})]),t._v(" "),a("h3",{attrs:{id:"常用微服务框架对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用微服务框架对比"}},[t._v("#")]),t._v(" 常用微服务框架对比")]),t._v(" "),a("h4",{attrs:{id:"服务发现-负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务发现-负载均衡"}},[t._v("#")]),t._v(" 服务发现 负载均衡")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214657658.png",alt:"image-20241119214657658"}})]),t._v(" "),a("h4",{attrs:{id:"服务熔断"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务熔断"}},[t._v("#")]),t._v(" 服务熔断")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214813336.png",alt:"image-20241119214813336"}})]),t._v(" "),a("h3",{attrs:{id:"问题1-微服务sdk多语言问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题1-微服务sdk多语言问题"}},[t._v("#")]),t._v(" 问题1：微服务SDK多语言问题")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214822288.png",alt:"image-20241119214822288"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214832088.png",alt:"image-20241119214832088"}})]),t._v(" "),a("h3",{attrs:{id:"问题2-基于sdk的微服务在k8s上运行的服务发现延迟和数据不一致问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题2-基于sdk的微服务在k8s上运行的服务发现延迟和数据不一致问题"}},[t._v("#")]),t._v(" 问题2：基于SDK的微服务在k8s上运行的服务发现延迟和数据不一致问题")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214840427.png",alt:"image-20241119214840427"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214848774.png",alt:"image-20241119214848774"}})]),t._v(" "),a("ul",[a("li",[t._v("pod在迁移过程中，注册中心来不及删除，导致了不一致问题")])]),t._v(" "),a("h3",{attrs:{id:"问题3-基于sdk开发的微服务-sdk逻辑升级-所有业务必须重新编译升级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题3-基于sdk开发的微服务-sdk逻辑升级-所有业务必须重新编译升级"}},[t._v("#")]),t._v(" 问题3：基于SDK开发的微服务，SDK逻辑升级，所有业务必须重新编译升级")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214859500.png",alt:"image-20241119214859500"}})]),t._v(" "),a("ul",[a("li",[t._v("网格升级可以单独升级\n"),a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214907463.png",alt:"image-20241119214907463"}})])]),t._v(" "),a("h3",{attrs:{id:"问题4-在把单体应用微服务化的时候-可能要一把把所有的服务都用sdk重写一遍-不能逐渐升级-否则可能不能服务发现等"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题4-在把单体应用微服务化的时候-可能要一把把所有的服务都用sdk重写一遍-不能逐渐升级-否则可能不能服务发现等"}},[t._v("#")]),t._v(" 问题4：在把单体应用微服务化的时候，可能要一把把所有的服务都用sdk重写一遍，不能逐渐升级，否则可能不能服务发现等")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214915304.png",alt:"image-20241119214915304"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214922309.png",alt:"image-20241119214922309"}})]),t._v(" "),a("h2",{attrs:{id:"怎么把微服务框架集成到服务网格"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#怎么把微服务框架集成到服务网格"}},[t._v("#")]),t._v(" 怎么把微服务框架集成到服务网格")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214930971.png",alt:"image-20241119214930971"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214939998.png",alt:"image-20241119214939998"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214947410.png",alt:"image-20241119214947410"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119214953956.png",alt:"image-20241119214953956"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119215001022.png",alt:"image-20241119215001022"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119215006829.png",alt:"image-20241119215006829"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119215112626.png",alt:"image-20241119215112626"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119215122595.png",alt:"image-20241119215122595"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119215132544.png",alt:"image-20241119215132544"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119215140955.png",alt:"image-20241119215140955"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119215148661.png",alt:"image-20241119215148661"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119215200568.png",alt:"image-20241119215200568"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119215206974.png",alt:"image-20241119215206974"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119215214422.png",alt:"image-20241119215214422"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119215222753.png",alt:"image-20241119215222753"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119215230853.png",alt:"image-20241119215230853"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119215240079.png",alt:"image-20241119215240079"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://markdown-1301334775.cos.eu-frankfurt.myqcloud.com/image-20241119215247367.png",alt:"image-20241119215247367"}})]),t._v(" "),a("ul",[a("li",[t._v("springboot的微服务用Istio部署在k8s的情况下，服务发现是用的IstioD，IstioD会与k8s的api server交互，获取K8s中service和endpoint信息，并将这些数据转换为服务网格的配置")])])])}),[],!1,null,null,null);a.default=e.exports}}]);